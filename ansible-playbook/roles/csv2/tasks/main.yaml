---
# cloudscheduler (v2) server maim.yaml

- set_fact:
    public_mariadb: false

- include_vars: "csv2-secrets.yaml"
- include_vars: "csv2-default-vars.yaml"
- include_vars: "csv2-vars.yaml"

- set_fact:
    ansible_ssh_port: "{{ ansible_ssh_port }}"

- import_tasks: configure_etc_hosts.yaml
- import_tasks: disable_selinux.yaml
- import_tasks: configure_root_mail_forwarding.yaml
- import_tasks: create_installation_directories.yaml
- import_tasks: configure_other_required_repositories.yaml
- import_tasks: perform_yum_updates.yaml
- import_tasks: install_other_required_packages.yaml
- import_tasks: install_python_pip.yaml
- import_tasks: install_python3.yaml
- import_tasks: letsencrypt.yaml
  when: (local_web is undefined) or (local_web == False)
- import_tasks: create_localhost_cert.yaml
  when: 
  - local_web is defined
  - local_web == True
- import_tasks: install_configure_ntpd.yaml
- import_tasks: install_configure_MariaDB.yaml
- import_tasks: create_mysqldb_csv2.yaml
- include: install_configure_httpd.yaml
- import_tasks: install_configure_phpmyadmin.yaml
  when:
  - install_phpMyAdmin is defined
  - install_phpMyAdmin == True
- import_tasks: install_EGI_trust_anchors.yaml
- import_tasks: install_fetch_crl.yaml
- import_tasks: install_EL7_HTCondor.yaml
- import_tasks: install_configure_csv2.yaml
- import_tasks: create_condor_poller_installation_tarball.yaml
- import_tasks: install_and_start_condor_poller.yaml
- import_tasks: install_influxdb.yaml
